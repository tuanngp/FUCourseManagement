@using FUBusiness.Models
@model IEnumerable<dynamic>
@{
    ViewBag.Title = "Quản lý đối tượng";

    // Lấy thông tin thuộc tính từ mô hình (nếu có dữ liệu)
    var properties = new List<string>();
    if (Model != null && Model.Any())
    {
        var firstItem = Model.FirstOrDefault();
        if (firstItem != null)
        {
            // Lấy tất cả thuộc tính từ đối tượng đầu tiên
            properties = ((IDictionary<string, Course>)firstItem).Keys.ToList();
        }
    }
}

<div class="container">
    <h2>@ViewBag.Title</h2>
    <p>
        <a href="@Url.Action("Create", ViewContext.RouteData.Values["controller"].ToString())" class="btn btn-primary">
            <i class="fa fa-plus"></i> Thêm mới
        </a>
    </p>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Danh sách đối tượng</h3>
            <div class="card-tools">
                <div class="input-group input-group-sm" style="width: 250px;">
                    <input type="text" id="search-box" class="form-control float-right" placeholder="Tìm kiếm...">
                    <div class="input-group-append">
                        <button type="button" class="btn btn-default" id="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body table-responsive p-0">
            <table class="table table-hover text-nowrap" id="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        @foreach (var prop in properties)
                        {
                            <th>@prop</th>
                        }
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        int index = 1;
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>@index</td>
                                @foreach (var prop in properties)
                                {
                                    <td>@(((IDictionary<string, object>)item)[prop])</td>
                                }
                                <td>
                                    <div class="btn-group">
                                        <a href="@Url.Action("Edit", ViewContext.RouteData.Values["controller"].ToString(), new { id = ((IDictionary<string, object>)item)["Id"] })" class="btn btn-sm btn-info">
                                            <i class="fa fa-edit"></i> Sửa
                                        </a>
                                        <a href="@Url.Action("Details", ViewContext.RouteData.Values["controller"].ToString(), new { id = ((IDictionary<string, object>)item)["Id"] })" class="btn btn-sm btn-primary">
                                            <i class="fa fa-eye"></i> Chi tiết
                                        </a>
                                        <a href="javascript:void(0);" class="btn btn-sm btn-danger delete-item" data-id="@(((IDictionary<string, object>)item)["Id"])">
                                            <i class="fa fa-trash"></i> Xóa
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            index++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="@(properties.Count + 2)" class="text-center">Không có dữ liệu</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="card-footer clearfix">
            <ul class="pagination pagination-sm m-0 float-right">
                <li class="page-item"><a class="page-link" href="#">&laquo;</a></li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">&raquo;</a></li>
            </ul>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function () {
            // Xử lý tìm kiếm
            $("#search-btn").click(function () {
                var value = $("#search-box").val().toLowerCase();
                $("#data-table tbody tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });

            // Xử lý xóa đối tượng
            $(".delete-item").click(function () {
                var id = $(this).data("id");
                if (confirm("Bạn có chắc chắn muốn xóa đối tượng này không?")) {
                    $.ajax({
                        url: '@Url.Action("Delete", ViewContext.RouteData.Values["controller"].ToString())/' + id,
                        type: 'POST',
                        data: { "__RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val() },
                        success: function (result) {
                            if (result.success) {
                                alert("Xóa thành công!");
                                location.reload();
                            } else {
                                alert("Xóa thất bại: " + result.message);
                            }
                        },
                        error: function () {
                            alert("Đã xảy ra lỗi khi xóa đối tượng!");
                        }
                    });
                }
            });
        });
    </script>
}